# Biblizap Server

A server and frontend application for performing snowball searches on academic literature using the Lens.org API.

## Project Description

Biblizap is a tool designed to help researchers find relevant academic papers by performing "snowball" searches. Starting from a list of initial papers (identified by PMIDs, DOIs, or Lens IDs), it recursively explores their references (downward citations) and the papers that cite them (upward citations) up to a specified depth. The results are then scored based on how many times they appear in the search path.

This repository contains the backend server (built with Rust and Actix-web) and the frontend web application (built with Rust and Yew) that provides a user interface for the snowball search functionality.

## Getting Started

### Prerequisites

- **Rust and Cargo** – Install via [rustup](https://rustup.rs):
    ```bash
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    ```
    After installation, ensure Cargo is available:
    ```bash
    cargo --version
    ```

- **WASM target for Rust** – Required to compile the frontend to WebAssembly:
    ```bash
    rustup target add wasm32-unknown-unknown
    ```

- **Trunk** – Used to build the Yew frontend:
    ```bash
    cargo install trunk
    ```

- **Lens.org API key** – Required for accessing citation data:  
    [Get your API key here](https://www.lens.org/lens/user/api-key)

### Installation

1. Clone the repository:
    ```bash
    git clone https://github.com/BibliZap/biblizap-server
    ```

2. Navigate to the project directory:
    ```bash
    cd biblizap-server
    ```

3. Build both frontend and backend:
    ```bash
    ./build.sh --release
    ```

    This script will:
    - Build the Yew frontend with `trunk build --release`
    - Then compile the Actix backend with `cargo build --release`

4. Optional: install system service

If you want the server installed as a systemd service and run without privileges, use the provided `install.sh` script.

Example (build first):

```bash
# build release binary first
./build.sh --release

# install to /usr/local/bin, set bind address and port
sudo ./install.sh \
    --lens-api-key YOUR_LENS_API_KEY \
    --install-dir /usr/local/bin \
    --bind-address 127.0.0.1 \
    --port 35642
```

What the installer does (when `systemd` is available):
- Creates a system group and user `biblizap` (no login).
- Installs the binary into the `--install-dir` (default `/usr/bin`).
- Writes `/etc/biblizap/biblizap.toml` containing `bind_address`, `port` and `lens_api_key` (mode `600`, owner `biblizap`).
- Writes a systemd unit at `/etc/systemd/system/biblizap.service`, enables and starts it.

If `systemd` is not present on the target machine, the installer will only copy the binary to `--install-dir` and will not create the config or service.

The installer defaults:
- `--install-dir`: `/usr/bin`
- `--bind-address`: `127.0.0.1`
- `--port`: `35642`

To check service status after install:

```bash
systemctl status biblizap.service
journalctl -u biblizap.service -f
```

To make configuration changes edit `/etc/biblizap/biblizap.toml` (it is created with mode 600) and then restart the service:

```bash
sudo systemctl daemon-reload
sudo systemctl restart biblizap.service
```

### Running the Server
### Configuration

The server can be configured in three ways (precedence highest -> lowest):

1. Command-line flags (CLI)
2. `./biblizap.toml`
3. `$XDG_CONFIG_HOME/biblizap/biblizap.toml`
4. `$HOME/.config/biblizap/biblizap.toml`
5. `/etc/biblizap/biblizap.toml`

For secrets, the installer writes `/etc/biblizap/biblizap.toml` with permissions set to `600` and owner `biblizap` when installing the systemd service. If you prefer, you can set the Lens API key via the environment variable `BIBLIZAP_LENS_API_KEY` instead of putting it in the toml file.

Configuration keys available in the TOML file:

- `bind_address` (string) — address to bind the HTTP server, e.g. `"127.0.0.1"`
- `port` (integer) — port to listen on, e.g. `35642`
- `lens_api_key` (string) — your Lens.org API key (keep file mode 600 if populated)

Examples:

`/etc/biblizap/biblizap.toml` (generated by installer):

```toml
bind_address = "127.0.0.1"
port = 35642
lens_api_key = "REPLACE_WITH_YOUR_LENS_KEY"
```

CLI flags override values in the config file. You can also supply the Lens API key using the environment variable `BIBLIZAP_LENS_API_KEY`.

### Running the Server

You can run the compiled executable directly, or install it as a systemd service using `install.sh` (recommended on systems with systemd).

Run the binary directly and supply the Lens API key (CLI flags override config files):

```bash
./target/release/biblizap-server --lens-api-key YOUR_LENS_API_KEY --bind-address 127.0.0.1 --port 35642
```

Defaults: bind_address=127.0.0.1, port=35642. The server will listen on the configured address and port; if you omit flags, values are taken from `./biblizap.toml`, `$XDG_CONFIG_HOME/biblizap/biblizap.toml`, or `/etc/biblizap/biblizap.toml` (precedence shown in `--help`).

To see the help text (includes config-file locations and precedence):

```bash
./target/release/biblizap-server --help
```

Once the server is running, open the frontend in your browser at the configured address and port, for example:

```
http://127.0.0.1:35642
```

## API Documentation

The server exposes a single POST endpoint at `/api`.
It expects a JSON body with the following structure:

```json
{
  "output_max_size": 100,
  "depth": 2,
  "input_id_list": ["10.1016/j.cell.2020.01.040", "32109876"],
  "search_for": "Both" // or "References", "Citations"
}
```

The response is a JSON array of article objects.

## Contributing

Contributions are welcome! Please check the [GitHub repository](https://github.com/BibliZap/BibliZap) for guidelines on how to contribute, report issues, or suggest features.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Contact

For questions or support, please refer to the contact information provided in the web application's "Contact" page or open an issue on the GitHub repository.